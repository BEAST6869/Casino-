import { Message, EmbedBuilder, ActionRowBuilder, ButtonBuilder, ButtonStyle } from "discord.js";import { getGuildConfig } from "../../services/guildConfigService";import { errorEmbed } from "../../utils/embed";import { fmtCurrency, parseSmartAmount } from "../../utils/format";export async function handleAsk(message: Message, args: string[]) {    if (!message.guild) return;    const config = await getGuildConfig(message.guild.id);    if (!(config as any).enableAskCommand) {        return message.reply({            embeds: [errorEmbed(message.author, "Feature Disabled", "The `!ask` command is currently disabled on this server.")]        });    }    const targetUser = message.mentions.users.first();    const amountStr = args.find(a => !a.startsWith("<@") && !isNaN(parseSmartAmount(a)));    const amount = amountStr ? parseSmartAmount(amountStr) : 0;    const reasonIndex = args.indexOf(amountStr || "") + 1;    const reason = args.slice(reasonIndex).join(" ") || "No reason provided";    if (!targetUser || amount <= 0) {        return message.reply({            embeds: [errorEmbed(message.author, "Invalid Usage", `Usage: \`${config.prefix}ask @user <amount> [reason]\`\nExample: \`${config.prefix}ask @Friend 100 For pizza\``)]        });    }    if (targetUser.id === message.author.id) {        return message.reply({ embeds: [errorEmbed(message.author, "Invalid Target", "You cannot ask yourself for money.")] });    }    if (targetUser.bot) {        return message.reply({ embeds: [errorEmbed(message.author, "Invalid Target", "You cannot ask bots for money.")] });    }    const embed = new EmbedBuilder()        .setTitle(`ðŸ’¸ Money Request`)        .setDescription(`**${message.author.username}** is asking **${targetUser.username}** for money.`)        .addFields(            { name: "Amount", value: `${fmtCurrency(amount, config.currencyEmoji)}`, inline: true },            { name: "Reason", value: reason, inline: true }        )        .setColor(0xFFFF00)         .setFooter({ text: "Click Accept to transfer immediately." });    const row = new ActionRowBuilder<ButtonBuilder>()        .addComponents(            new ButtonBuilder()                .setCustomId(`ask_accept:${message.author.id}:${amount}`)                .setLabel("Accept")                .setStyle(ButtonStyle.Success),            new ButtonBuilder()                .setCustomId(`ask_decline:${message.author.id}`)                .setLabel("Decline")                .setStyle(ButtonStyle.Danger)        );    return (message.channel as any).send({        content: `<@${targetUser.id}>`,        embeds: [embed],        components: [row]    });}