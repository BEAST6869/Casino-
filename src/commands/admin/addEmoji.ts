import { Message } from "discord.js";import { setPersistedEmoji, getEmojiRecord } from "../../utils/emojiRegistry";import { successEmbed, errorEmbed } from "../../utils/embed";import { canExecuteAdminCommand } from "../../utils/permissionUtils";export async function handleAddEmoji(message: Message, args: string[]) {  try {    if (!message.member || !(await canExecuteAdminCommand(message, message.member))) {      return message.reply({ embeds: [errorEmbed(message.author, "No permission", "Admins or Bot Commanders only.")] });    }    const key = args[0];    const emojiArg = args[1];    if (!key || !emojiArg) {      return message.reply({ embeds: [errorEmbed(message.author, "Usage", "`!addemoji <key> <emoji|id>`")] });    }    const mentionMatch = emojiArg.match(/<?a?:?(\w+):(\d+)>?/);    let id: string | undefined;    let name: string | undefined;    if (mentionMatch) {      name = mentionMatch[1];      id = mentionMatch[2];    } else if (/^\d+$/.test(emojiArg)) {      id = emojiArg;    } else {      const found = message.client.emojis.cache.find(e => e.name === emojiArg);      if (found) {        id = found.id;        name = found.name;      }    }    if (!id) {      return message.reply({ embeds: [errorEmbed(message.author, "Invalid emoji", "Please provide a valid emoji mention or id")] });    }    const cached = message.client.emojis.cache.get(id);    const animated = !!cached?.animated;    const rec = { id, name: name ?? cached?.name ?? key, animated };    setPersistedEmoji(key, rec);    return message.reply({ embeds: [successEmbed(message.author, "Emoji mapped", `Key \`${key}\` â†’ emoji id \`${id}\``)] });  } catch (err) {    console.error("handleAddEmoji error:", err);    return message.reply({ embeds: [errorEmbed(message.author, "Error", "Failed to map emoji")] });  }}